apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- script: |
    ../../../bin/helm 
    helm repo add datastax-pulsar https://datastax.github.io/pulsar-helm-chart
    helm repo update
    helm install pulsar --create-namespace -f config/dev-values.yaml datastax-pulsar/pulsar
  ignoreFailure: false
- script: |
    PULSAR_POD=$(kubectl get pods -l=app=pulsar -l=component=bastion -o=jsonpath='{.items[0].metadata.name}')
    until kubectl cp ./pulsar-source-config.sh $PULSAR_POD:/pulsar/; do sleep 10; done;
  ignoreFailure: false
- script: |
    PULSAR_POD=$(kubectl get pods -l=app=pulsar -l=component=bastion -o=jsonpath='{.items[0].metadata.name}')
    until kubectl exec $PULSAR_POD -- bash -c 'source /pulsar/pulsar-source-config.sh'; do sleep 5; done;
  ignoreFailure: false